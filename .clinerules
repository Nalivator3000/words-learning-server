# ğŸ¤– Critical Rules for LexyBooster Project

## ğŸ”´ RULE #1: Git Branch Policy - ALWAYS USE DEVELOP

**âœ… CORRECT:**
```bash
git push origin develop
```

**âŒ WRONG:**
```bash
git push origin main
git push origin master
git push  # May push to wrong branch
```

**Why:**
- `develop` is the main development branch
- `main` is for production-ready code only
- Railway auto-deploys from `develop` branch
- Prevents accidental production deployments

**Exception:** Only push to `main` if explicitly requested by the user with clear intent for production deployment.

---

## ğŸ”´ RULE #2: Testing Environment

**CRITICAL:**
- âœ… **ALL tests run ONLY on Railway production**
- âŒ **NEVER test locally** - no local database setup
- âœ… Test user IP is whitelisted: `176.199.209.166`
- âœ… Use production URL: `https://words-learning-server-production.up.railway.app`

---

## ğŸ”´ RULE #3: Standard Git Workflow

```bash
# 1. Stage changes
git add .

# 2. Commit with descriptive message
git commit -m "feat: descriptive message

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"

# 3. ALWAYS push to develop (NOT main!)
git push origin develop
```

---

## ğŸ”´ RULE #4: File Operations

- âœ… Use Read/Edit/Write tools (NOT bash cat/sed/echo)
- âœ… Always read files before editing
- âœ… Use TodoWrite for multi-step tasks
- âŒ Never use bash for file operations

---

## ğŸ”´ RULE #5: Railway Deployment

After pushing to develop:
```bash
# Railway auto-deploys from develop branch
# Wait ~30 seconds for deployment

# If migrations needed, provide user with these commands:
railway login
railway run npm run db:migrate:progress
railway run npm run db:create-word-sets
railway run npm run db:migrate:users
```

**Important:** Railway CLI requires interactive login - cannot be automated by agents.

---

## ğŸ“‹ Quick Reference

### Key NPM Scripts
```bash
# Development
npm start                      # Start server
npm run dev                    # Start with nodemon

# Database (Railway only - requires railway login)
railway run npm run db:migrate:progress    # Create user_word_progress table
railway run npm run db:create-word-sets    # Populate word_sets
railway run npm run db:migrate:users       # Migrate existing users

# Testing (ONLY on Railway production)
npm run test:e2e:production:smoke    # Quick smoke test (5-7 min)
npm run test:e2e:production          # Critical tests (10-15 min)
npm run test:e2e:production:full     # Full E2E suite (60+ min)
```

### Database Architecture
- Source vocabularies (`source_words_*`) are shared by all users
- User progress tracked separately in `user_word_progress`
- JOINs fetch user-specific data

**Key Tables:**
- `source_words_german` - 8,076 words (shared)
- `user_word_progress` - Individual progress
- `word_sets` - 170+ organized collections
- `users` - User accounts
- `language_pairs` - User preferences

---

## âš ï¸ Common Pitfalls to Avoid

1. **Never push to `main` by default** - Always use `develop`
2. **Never commit sensitive data** - Check .env, credentials, API keys
3. **Never use bash for file operations** - Use Read/Edit/Write/Grep tools
4. **Never assume Railway CLI is logged in** - Remind user to `railway login`
5. **Always read files before editing** - Use Read tool first
6. **NEVER test locally** - All testing ONLY on Railway production environment

---

## âœ… Pre-Commit Checklist

- [ ] Read relevant code before making changes
- [ ] Use TodoWrite for multi-step tasks
- [ ] Test changes (minimum: syntax check)
- [ ] Commit with descriptive message
- [ ] **Push to `develop` branch** â† CRITICAL!
- [ ] Create clear manual instructions if needed
- [ ] Verify no sensitive data in commits

---

**Version:** 2.0
**Last Updated:** January 6, 2026
**For:** Claude Code AI Agents
