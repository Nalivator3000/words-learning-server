# üêõ AUTO-PROMOTION Fix

## –ü—Ä–æ–±–ª–µ–º–∞

–°–ª–æ–≤–∞ –ù–ï –ø–µ—Ä–µ—Ö–æ–¥–∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã SRS, –¥–∞–∂–µ –∫–æ–≥–¥–∞ –Ω–∞–±–∏—Ä–∞–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–ª–æ–≤.

## –ü—Ä–∏—á–∏–Ω–∞

**–õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ –ø–æ—Ä—è–¥–∫–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞** –≤ [server-postgresql.js:11023-11100](server-postgresql.js#L11023-L11100):

1. –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–æ–≥–æ–≤ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ (—Å—Ç—Ä–æ–∫–∏ 11026-1075)
2. –ü–û–°–õ–ï —ç—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å AUTO-PROMOTION (—Å—Ç—Ä–æ–∫–∏ 11077-11130)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ï—Å–ª–∏ —Å–ª–æ–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–ª–æ –∏–∑ `studying` –≤ `review_1`, —Ç–æ `newStatus` –º–µ–Ω—è–ª—Å—è –Ω–∞ `review_1`, –∏ AUTO-PROMOTION –ù–ï –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–ª–∞ `if (newStatus === 'studying')` - –Ω–æ —Å—Ç–∞—Ç—É—Å —É–∂–µ –∏–∑–º–µ–Ω–∏–ª—Å—è!

## –†–µ—à–µ–Ω–∏–µ

–ò–∑–º–µ–Ω–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

1. **–°–ù–ê–ß–ê–õ–ê** –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Ü–µ–ª–µ–≤–æ–π —Ü–∏–∫–ª (targetReviewCycle) –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–∏—Ö –±–∞–ª–ª–æ–≤
2. **–ó–ê–¢–ï–ú** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, –Ω—É–∂–Ω–æ –ª–∏ AUTO-PROMOTION (–µ—Å–ª–∏ targetReviewCycle > current)
3. **–¢–û–õ–¨–ö–û –ü–û–¢–û–ú** –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –æ–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞:

```javascript
// –°–ª–æ–≤–æ –∏–º–µ–µ—Ç 25 –±–∞–ª–ª–æ–≤, reviewCycle = 0, status = 'studying'
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–≤–µ—Ç–∏–ª –∏ –ø–æ–ª—É—á–∏–ª +2 –±–∞–ª–ª–∞
newCorrectCount = 27; // –¢–µ–ø–µ—Ä—å 27 –±–∞–ª–ª–æ–≤

// –®–∞–≥ 1: –ù–∞—Ö–æ–¥–∏–º —Ü–µ–ª–µ–≤–æ–π —Ü–∏–∫–ª
// stageThresholds = [20, 35, 50, 65, 80, 90, 100]
// 27 >= 20 ‚Üí targetReviewCycle = 0 (review_1)

// –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º AUTO-PROMOTION
// targetReviewCycle (0) == reviewCycle (0) ‚Üí –Ω–µ—Ç –ø–æ–≤—ã—à–µ–Ω–∏—è

// –®–∞–≥ 3: –û–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞
// –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ø–æ—Ä–æ–≥ 20 ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –≤ review_1
```

**–î—Ä—É–≥–æ–π –ø—Ä–∏–º–µ—Ä**:
```javascript
// –°–ª–æ–≤–æ –∏–º–µ–µ—Ç 48 –±–∞–ª–ª–æ–≤, reviewCycle = 1, status = 'review_3'
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–≤–µ—Ç–∏–ª –∏ –ø–æ–ª—É—á–∏–ª +7 –±–∞–ª–ª–æ–≤
newCorrectCount = 55; // –¢–µ–ø–µ—Ä—å 55 –±–∞–ª–ª–æ–≤

// –®–∞–≥ 1: –ù–∞—Ö–æ–¥–∏–º —Ü–µ–ª–µ–≤–æ–π —Ü–∏–∫–ª
// 55 >= 50 ‚Üí targetReviewCycle = 2 (review_7)

// –®–∞–≥ 2: AUTO-PROMOTION
// targetReviewCycle (2) > reviewCycle (1) ‚Üí –ê–í–¢–û–ü–û–í–´–®–ï–ù–ò–ï!
// –°–ª–æ–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ review_7 (cycle 2)
```

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –î–æ (–ù–ï –†–ê–ë–û–¢–ê–õ–û):
```javascript
// –°–Ω–∞—á–∞–ª–∞ –∏–∑–º–µ–Ω—è–ª–∏ —Å—Ç–∞—Ç—É—Å
if (word.status === 'studying' && newCorrectCount >= currentThreshold) {
    newStatus = `review_${intervalDays}`; // ‚Üê newStatus –∏–∑–º–µ–Ω–µ–Ω
}

// –ü–û–¢–û–ú –ø—ã—Ç–∞–ª–∏—Å—å —Å–¥–µ–ª–∞—Ç—å AUTO-PROMOTION
if (newStatus === 'studying') { // ‚Üê –ù–æ newStatus —É–∂–µ –ù–ï 'studying'!
    // –≠—Ç–∞ –ª–æ–≥–∏–∫–∞ –ù–ò–ö–û–ì–î–ê –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å!
}
```

### –ü–æ—Å–ª–µ (–†–ê–ë–û–¢–ê–ï–¢):
```javascript
// –°–ù–ê–ß–ê–õ–ê AUTO-PROMOTION
let targetReviewCycle = newReviewCycle;
for (let i = stageThresholds.length - 1; i >= 0; i--) {
    if (newCorrectCount >= stageThresholds[i]) {
        targetReviewCycle = i;
        break;
    }
}

if (targetReviewCycle > newReviewCycle) {
    // –ê–≤—Ç–æ–ø–æ–≤—ã—à–µ–Ω–∏–µ –Ω–∞ –Ω—É–∂–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
    newReviewCycle = targetReviewCycle;
    newStatus = `review_${srsIntervals[newReviewCycle]}`;
} else {
    // –û–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞
}
```

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–ª–æ–≤

–î–ª—è —Å–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∏–º–µ—é—Ç –±–∞–ª–ª—ã, –Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å, —Å–æ–∑–¥–∞–Ω SQL —Å–∫—Ä–∏–ø—Ç:

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ**: `fix-word-stages.sql`

–≠—Ç–æ –æ–±–Ω–æ–≤–∏—Ç –≤—Å–µ —Å–ª–æ–≤–∞ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —ç—Ç–∞–ø—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö —Ç–µ–∫—É—â–∏—Ö –±–∞–ª–ª–æ–≤.

### –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç:

```bash
psql -U postgres -d words_learning -f fix-word-stages.sql
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ **–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò** –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Å–ª–æ–≤–∞ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —ç—Ç–∞–ø—ã:

- **20 –±–∞–ª–ª–æ–≤** ‚Üí `review_1` (–ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 1 –¥–µ–Ω—å)
- **35 –±–∞–ª–ª–æ–≤** ‚Üí `review_3` (–ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 3 –¥–Ω—è)
- **50 –±–∞–ª–ª–æ–≤** ‚Üí `review_7` (–ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π)
- **65 –±–∞–ª–ª–æ–≤** ‚Üí `review_14` (–ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 14 –¥–Ω–µ–π)
- **80 –±–∞–ª–ª–æ–≤** ‚Üí `review_30` (–ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π)
- **90 –±–∞–ª–ª–æ–≤** ‚Üí `review_60` (–ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 60 –¥–Ω–µ–π)
- **100 –±–∞–ª–ª–æ–≤** ‚Üí `mastered` (–æ—Å–≤–æ–µ–Ω–æ!)

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:

1. –í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–æ —Å 18 –±–∞–ª–ª–∞–º–∏
2. –û—Ç–≤–µ—Ç—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞ Word Building (+4 –±–∞–ª–ª–∞)
3. –°–ª–æ–≤–æ –¥–æ–ª–∂–Ω–æ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø–µ—Ä–µ–π—Ç–∏ –≤ `review_1` (22 –±–∞–ª–ª–∞ >= 20)

–õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ–∫–∞–∂—É—Ç:
```
üöÄ AUTO-PROMOTION: Word 123 at 22 points (threshold: 20)! Promoted from studying to review_1 (cycle 0)
```

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 2025-11-18
**–ö–æ–º–º–∏—Ç**: 3ce851d
