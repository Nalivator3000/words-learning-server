# –¢–ï–ö–£–©–ê–Ø –ó–ê–î–ê–ß–ê: –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã (Personal Insights)

## –ö–û–ù–¢–ï–ö–°–¢
–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –µ—Å—Ç—å –±–æ–≥–∞—Ç–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è (XP logs, quiz results, activity patterns), –Ω–æ –Ω–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫ –∏ –∏–Ω—Å–∞–π—Ç–æ–≤. –ù—É–∂–Ω–∞ —Å–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ–∑–Ω—ã–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è.

## –¶–ï–õ–¨
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å backend API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –∏–Ω—Å–∞–π—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –æ–±—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨

### 1. –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–Ω—Å–∞–π—Ç–æ–≤

**–¢–∏–ø—ã –∏–Ω—Å–∞–π—Ç–æ–≤:**
1. **–í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è** (Best learning time)
   - "–í—ã –ª—É—á—à–µ –≤—Å–µ–≥–æ —É—á–∏—Ç–µ—Å—å —É—Ç—Ä–æ–º" (6-12)
   - "–í–∞—à –ª—é–±–∏–º—ã–π —á–∞—Å –¥–ª—è –∑–∞–Ω—è—Ç–∏–π - 20:00"
   - –ê–Ω–∞–ª–∏–∑: COUNT –∏ AVG(xp) –ø–æ —á–∞—Å–∞–º –¥–Ω—è

2. **–¢–∏–ø —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π** (Favorite exercise type)
   - "–í–∞—à –ª—é–±–∏–º—ã–π —Ç–∏–ø —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π - Multiple Choice"
   - "–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ XP –∏–∑ Quiz"
   - –ê–Ω–∞–ª–∏–∑: GROUP BY action_type –≤ xp_log

3. **–ü—Ä–æ–≥—Ä–µ—Å—Å** (Progress rate)
   - "–í—ã –≤—ã—É—á–∏–ª–∏ 20% –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –≤ –ø—Ä–æ—à–ª–æ–º –º–µ—Å—è—Ü–µ"
   - "–í–∞—à —Ç–µ–º–ø –æ–±—É—á–µ–Ω–∏—è —É—Å–∫–æ—Ä–∏–ª—Å—è –Ω–∞ 35%"
   - –ê–Ω–∞–ª–∏–∑: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ XP –∑–∞ —Ç–µ–∫—É—â–∏–π –∏ –ø—Ä–æ—à–ª—ã–π –ø–µ—Ä–∏–æ–¥

4. **Streak –ø–∞—Ç—Ç–µ—Ä–Ω—ã** (Streak patterns)
   - "–í—ã –Ω–∞–∏–±–æ–ª–µ–µ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã –ø–æ –≤—Ç–æ—Ä–Ω–∏–∫–∞–º"
   - "–í—ã—Ö–æ–¥–Ω—ã–µ - –≤–∞—à–µ —Å–∞–º–æ–µ –∞–∫—Ç–∏–≤–Ω–æ–µ –≤—Ä–µ–º—è"
   - –ê–Ω–∞–ª–∏–∑: Day of week –≤ activity_log

5. **–¢–æ—á–Ω–æ—Å—Ç—å** (Accuracy trends)
   - "–í–∞—à–∞ —Ç–æ—á–Ω–æ—Å—Ç—å —É–ª—É—á—à–∏–ª–∞—Å—å –Ω–∞ 15% –∑–∞ –º–µ—Å—è—Ü"
   - "–í—ã –¥–µ–ª–∞–µ—Ç–µ –º–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫ –≤ –Ω–æ–≤—ã—Ö —Å–ª–æ–≤–∞—Ö"
   - –ê–Ω–∞–ª–∏–∑: correctcount/incorrectcount –≤ words

### 2. Backend API Endpoint

**Endpoint:** `GET /api/users/:userId/insights`

**Query Parameters:**
- `period` (optional): 'week', 'month', 'all' (default: 'month')
- `limit` (optional): –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Å–∞–π—Ç–æ–≤ (default: 5)

**Response:**
```json
{
  "insights": [
    {
      "id": "best_time",
      "type": "learning_time",
      "title": "–í—ã –ª—É—á—à–µ –≤—Å–µ–≥–æ —É—á–∏—Ç–µ—Å—å —É—Ç—Ä–æ–º",
      "description": "83% –≤–∞—à–µ–≥–æ XP –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –º–µ–∂–¥—É 8:00 –∏ 12:00",
      "icon": "‚òÄÔ∏è",
      "priority": "high",
      "data": {
        "peak_hour": 9,
        "peak_hour_xp_percentage": 35
      }
    },
    {
      "id": "favorite_exercise",
      "type": "exercise_preference",
      "title": "–í–∞—à –ª—é–±–∏–º—ã–π —Ç–∏–ø —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π - Quiz",
      "description": "–í—ã –ø—Ä–æ—à–ª–∏ 45 –∫–≤–∏–∑–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü",
      "icon": "üìù",
      "priority": "medium",
      "data": {
        "favorite_type": "quiz_completed",
        "count": 45
      }
    },
    {
      "id": "progress_acceleration",
      "type": "progress",
      "title": "–í—ã –≤—ã—É—á–∏–ª–∏ 28% –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –≤ –ø—Ä–æ—à–ª–æ–º –º–µ—Å—è—Ü–µ",
      "description": "–í–∞—à —Å—Ä–µ–¥–Ω–∏–π —Ç–µ–º–ø: 15 —Å–ª–æ–≤/–¥–µ–Ω—å (–±—ã–ª–æ 12)",
      "icon": "üöÄ",
      "priority": "high",
      "data": {
        "improvement_percentage": 28,
        "current_rate": 15,
        "previous_rate": 12
      }
    }
  ],
  "generated_at": "2025-10-16T12:00:00Z"
}
```

### 3. SQL Queries

**Best learning time:**
```sql
SELECT
  EXTRACT(HOUR FROM created_at) as hour,
  COUNT(*) as activities,
  SUM(xp_earned) as total_xp
FROM xp_log
WHERE user_id = $1
  AND created_at >= NOW() - INTERVAL '30 days'
GROUP BY hour
ORDER BY total_xp DESC
LIMIT 3
```

**Favorite exercise type:**
```sql
SELECT
  action_type,
  COUNT(*) as count,
  SUM(xp_earned) as total_xp
FROM xp_log
WHERE user_id = $1
  AND created_at >= NOW() - INTERVAL '30 days'
GROUP BY action_type
ORDER BY count DESC
LIMIT 1
```

**Progress rate comparison:**
```sql
-- Current month
SELECT COUNT(DISTINCT word_id) as words_learned
FROM words
WHERE user_id = $1
  AND created_at >= DATE_TRUNC('month', NOW())

-- Previous month
SELECT COUNT(DISTINCT word_id) as words_learned
FROM words
WHERE user_id = $1
  AND created_at >= DATE_TRUNC('month', NOW() - INTERVAL '1 month')
  AND created_at < DATE_TRUNC('month', NOW())
```

### 4. Insight Generation Logic

```javascript
async function generateInsights(userId, period = 'month') {
  const insights = [];

  // 1. Best learning time
  const timeData = await getBestLearningTime(userId, period);
  if (timeData.peak_hour) {
    insights.push({
      id: 'best_time',
      type: 'learning_time',
      title: getTimeInsightTitle(timeData.peak_hour),
      description: `${timeData.percentage}% –≤–∞—à–µ–≥–æ XP –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ —ç—Ç–æ –≤—Ä–µ–º—è`,
      icon: getTimeIcon(timeData.peak_hour),
      priority: 'high',
      data: timeData
    });
  }

  // 2. Favorite exercise
  const exerciseData = await getFavoriteExercise(userId, period);
  if (exerciseData.type) {
    insights.push({...});
  }

  // 3. Progress comparison
  const progressData = await getProgressComparison(userId);
  if (progressData.improvement > 0) {
    insights.push({...});
  }

  return insights;
}
```

### 5. Helper Functions

```javascript
function getTimeInsightTitle(hour) {
  if (hour >= 6 && hour < 12) return "–í—ã –ª—É—á—à–µ –≤—Å–µ–≥–æ —É—á–∏—Ç–µ—Å—å —É—Ç—Ä–æ–º";
  if (hour >= 12 && hour < 18) return "–í—ã –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã –¥–Ω—ë–º";
  if (hour >= 18 && hour < 22) return "–í–µ—á–µ—Ä - –≤–∞—à–µ –ª—É—á—à–µ–µ –≤—Ä–µ–º—è";
  return "–í—ã –Ω–æ—á–Ω–∞—è —Å–æ–≤–∞";
}

function getTimeIcon(hour) {
  if (hour >= 6 && hour < 12) return "‚òÄÔ∏è";
  if (hour >= 12 && hour < 18) return "üå§Ô∏è";
  if (hour >= 18 && hour < 22) return "üåÜ";
  return "üåô";
}
```

### 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Test insights endpoint
curl http://localhost:3001/api/users/1/insights

# Test with period parameter
curl "http://localhost:3001/api/users/1/insights?period=week&limit=3"
```

## –í–ê–ñ–ù–û
1. –û–±–Ω–æ–≤–∏—Ç—å `PLAN.md`: –∑–∞–º–µ–Ω–∏—Ç—å `[ ]` –Ω–∞ `[>]` –¥–ª—è –∑–∞–¥–∞—á–∏ "–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã"
2. –í–µ—Ä–Ω—É—Ç—å –º–∏–Ω–∏–º—É–º 3 –∏–Ω—Å–∞–π—Ç–∞, –º–∞–∫—Å–∏–º—É–º 10
3. –¢–æ–ª—å–∫–æ –∏–Ω—Å–∞–π—Ç—ã —Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–º–∏–Ω–∏–º—É–º 5 –∑–∞–ø–∏—Å–µ–π)
4. –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ 1 —á–∞—Å (Redis –∏–ª–∏ in-memory)

## –ì–û–¢–û–í–û –ö–û–ì–î–ê
- [ ] Endpoint `/api/users/:userId/insights` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ú–∏–Ω–∏–º—É–º 3 —Ç–∏–ø–∞ –∏–Ω—Å–∞–π—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç (time, exercise, progress)
- [ ] SQL queries –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã (WITH indexes)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] PLAN.md –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] –ö–æ–¥ –∑–∞–∫–æ–º–º–∏—á–µ–Ω

## –ë–û–ù–£–° (OPTIONAL)
- Streak patterns (–¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –∞–Ω–∞–ª–∏–∑)
- Accuracy trends (improvement over time)
- Weekly summary (–¥–∞–π–¥–∂–µ—Å—Ç –∑–∞ –Ω–µ–¥–µ–ª—é)
