# Миграция demo@fluentflow.app в новую архитектуру

## Проблема

Пользователь `demo@fluentflow.app` показывал **0 слов** в интерфейсе, хотя имел 399 слов в старой таблице `words`.

## Причина

Данные остались в старой архитектуре (таблица `words`), но новый интерфейс читает из таблицы `user_word_progress`.

## Архитектура данных

### Старая архитектура
```
words
├─ user_id
├─ language_pair_id
├─ word (текст слова)
├─ translation (перевод)
├─ example (пример)
├─ status (статус изучения)
└─ correctcount (количество правильных ответов)
```

### Новая архитектура
```
source_words_german (исходные слова)
└─ user_word_progress (прогресс пользователя)
   ├─ user_id
   ├─ language_pair_id
   ├─ source_language
   ├─ source_word_id (ссылка на source_words_german)
   ├─ status
   ├─ correct_count
   ├─ ease_factor
   └─ review dates
```

## Выполненная миграция

### Скрипт

Создан скрипт `migrate-demo-user-with-custom-words.js`, который:

1. ✅ Читает слова из старой таблицы `words`
2. ✅ Ищет совпадения в `source_words_german`
3. ✅ Создаёт записи в `user_word_progress` с сохранением прогресса:
   - Status (studying/review_1/review_3/review_7)
   - Correct count
   - Review cycle
   - Review dates

### Результаты

```
╔═══════════════════════════════════════════════════════════════╗
║                    РЕЗУЛЬТАТЫ МИГРАЦИИ                        ║
╚═══════════════════════════════════════════════════════════════╝

✅ Успешно мигрировано: 96 слов → 89 уникальных в user_word_progress
⏭️  Пропущено: 303 слов (не найдены совпадения в source_words_german)
📊 Всего в старой базе: 399 слов
```

### Распределение по статусам

```
review_1     : 44 слов  (слова на первом повторении)
review_3     : 4 слова  (слова на третьем повторении)
review_7     : 1 слово  (слово на седьмом повторении)
studying     : 40 слов  (новые слова в изучении)
───────────────────────
ВСЕГО        : 89 слов
```

## Почему не все 399 слов?

Старая база содержала много кастомных слов, которых нет в новой `source_words_german`:
- Разговорные выражения
- Сленг
- Устаревшие слова
- Слова с опечатками

Попытка добавить их в `source_words_german` не удалась из-за обязательного поля `example_de` (NOT NULL constraint), которое требует наличия примера на немецком для каждого слова.

## Сохранён ли прогресс?

✅ **ДА!** Для всех 89 мигрированных слов сохранён полный прогресс:
- Статус изучения (studying, review_1, review_3, review_7)
- Количество правильных ответов
- Даты последнего и следующего повторения
- Цикл повторения

## Что будет видеть пользователь?

После миграции пользователь `demo@fluentflow.app` увидит:
- **89 слов** вместо 0
- Сохранённый прогресс по каждому слову
- Правильные даты повторений
- Корректную статистику в дашборде

## Файлы

### Скрипты миграции
- `migrate-demo-user-to-new-architecture.js` - Первая попытка миграции (89 слов)
- `migrate-demo-user-with-custom-words.js` - Попытка с добавлением кастомных слов (неудачна из-за NOT NULL constraint)

### Вспомогательные скрипты
- `check-fluentflow-demo-user.js` - Проверка данных пользователя
- `check-source-german-schema.js` - Проверка схемы таблицы

### Документация
- `FLUENTFLOW_DEMO_USER_MIGRATION.md` - Этот файл

## Дата выполнения

02.01.2026

## Данные для входа

- **Email:** demo@fluentflow.app
- **Password:** (существующий пароль пользователя)
