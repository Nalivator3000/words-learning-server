# ✅ Автоматическое обновление версии настроено

## Что реализовано

### 1. ✅ Pre-commit Hook
**Файл:** `.git/hooks/pre-commit`

Автоматически при каждом коммите:
- Запускает скрипт обновления версии
- Обновляет версию в `public/index.html`
- Добавляет измененный `index.html` в коммит
- Показывает напоминание о проверке актуальности версии
- Напоминает о времени деплоя (2-3 минуты)

### 2. ✅ Update Version Script
**Файл:** `scripts/utils/update-version.js`

Функциональность:
- Читает версию из `package.json`
- Получает текущий commit hash из git
- Обновляет комментарий `<!-- Version: v5.4.9 -->` в `index.html`

### 3. ✅ Документация

#### Для разработчиков:
- **AUTO_VERSION_UPDATE.md** - полная документация системы
- **AGENT_VERSION_RULES.md** - краткие правила для агентов

## Как это работает

### Обычный workflow:

```bash
# 1. Проверка актуальности (ОБЯЗАТЕЛЬНО при работе нескольких агентов)
git pull origin develop

# 2. Внесение изменений
# ... редактирование файлов ...

# 3. Коммит
git add .
git commit -m "feat: New feature"

# Hook автоматически:
# ✅ Обновит версию в index.html
# ✅ Добавит index.html в коммит
# ✅ Покажет напоминания

# 4. Push
git push origin develop

# 5. Ожидание деплоя
# Railway деплой: 2-3 минуты
```

### Вывод при коммите:

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔄 Auto-updating version information...
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔄 Updating version...
✅ Version updated to: v5.4.9 (commit: 1bd2bb0)
✨ Version update complete!
✅ Version updated in index.html

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚠️  ВАЖНО: Перед push проверьте актуальность версии!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📌 Если параллельно работают несколько агентов:
   1. Перед push: git pull origin develop
   2. Разрешите конфликты (если есть)
   3. Затем: git push origin develop

📝 После push на Railway деплой займет 2-3 минуты
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## Обновление версии в package.json

Используйте npm скрипты для изменения версии:

```bash
# Patch версия (5.4.9 → 5.4.10)
npm run version:patch

# Minor версия (5.4.9 → 5.5.0)
npm run version:minor

# Major версия (5.4.9 → 6.0.0)
npm run version:major
```

## Важные замечания

### ⚠️ Для работы нескольких агентов

**ВСЕГДА** перед push делайте:
```bash
git pull origin develop
```

Это предотвращает конфликты версий при параллельной работе.

### 🧪 Тестирование пользователем

**Важно для агентов:**
- Пользователь ВСЕГДА тестирует в режиме инкогнито (без кеша)
- Все скриншоты делаются в инкогнито
- Если пользователь сообщает о проблеме - это НЕ кеш браузера
- Проблема реальная, нужно исправлять код

### 📍 Где хранится версия

1. **Source of Truth:** `package.json` - версия `5.4.9`
2. **HTML комментарий:** `public/index.html` - `<!-- Version: v5.4.9 -->`
3. **UI отображение:** Правый нижний угол - `App: 5.4.9`

### ⏱️ Время деплоя

После `git push origin develop`:
- Railway начинает деплой автоматически
- Деплой занимает **2-3 минуты**
- Проверка: https://lexybooster.com/

## Тестирование

### Проверка работы скрипта:
```bash
node scripts/utils/update-version.js
```

### Проверка версии в HTML:
```bash
grep "<!-- Version:" public/index.html
```

### Проверка hook:
```bash
ls -la .git/hooks/pre-commit
```

## Структура файлов

```
.git/hooks/
  └── pre-commit                    # Git hook (исполняемый)

scripts/utils/
  └── update-version.js             # Скрипт обновления

public/
  └── index.html                    # HTML с версией

package.json                        # Источник версии

AUTO_VERSION_UPDATE.md              # Полная документация
AGENT_VERSION_RULES.md              # Краткие правила для агентов
VERSION_AUTO_UPDATE_COMPLETE.md     # Этот файл
```

## Успешно реализовано ✅

- [x] Pre-commit hook для автоматического обновления
- [x] Скрипт обновления версии из package.json
- [x] Напоминание о проверке актуальности версии
- [x] Напоминание о времени деплоя (2-3 минуты)
- [x] Документация для разработчиков
- [x] Краткие правила для агентов
- [x] Тестирование системы

---

**Дата:** 2026-01-06
**Текущая версия:** v5.4.9
**Статус:** ✅ Готово к использованию
